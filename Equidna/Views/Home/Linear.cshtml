@{
    ViewBag.Title = "Modelo lineal";
}

<h2>Modelo lineal</h2>

<div><h1 id="FormulaDisplayDiv" style="text-align: center"></h1></div>
<div class="col-xs-12" align="center">
    <input id="number2"  type="number" step="0.01" onchange="updateFromNumber();" />
    <input id="number" type="number" step="0.01" onchange="updateFromNumber();" />
</div>

<div class="row">
    
    <div class="col-xs-12">
        <div id="sliderBox" class="jxgbox" style="width: 100%; height: 100px;"></div>
        <label for="startTime">Start time: <input name="startTime" type="number" value="0"/></label>
        <label for="endTime">End time: <input name="endTime" type="number" value="9"/></label>

        <button id="start" onclick="Start()">Start</button>
    </div>
</div>


   

<div class="row">
    <div class="col-xs-6 ">
        <div id='VelocityBoard' class='jxgbox graphbox'        style='user-select: none; overflow: hidden; position: relative;'></div>
    </div>
    
    <div class="col-xs-4">
        <div class="row">
            <div class="panel panel-default">
                <div class="panel-heading">
                    <h4 id="Formuvelo" style="text-align: center">
                        
                    </h4>
                </div>
                <table class="table table-fixed">
                    <thead >
                        <tr >
                            <th class="col-xs-2 " >X</th>
                            <th class="col-xs-8 "></th>
                            <th class="col-xs-2 " >Y</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td class="col-xs-2">
                               0
                            </td>
                          
                            <td class="col-xs-10">
                                <input type="number" id="x1" name='x1' step="0.01" class="form-control" style="text-align: center"  />
                            </td>
                        </tr>
                        <tr>
                            <td class="col-xs-2">0</td>

                            <td class="col-xs-10">
                                <input type="number" id="x2" name='x1' step="0.01" class="form-control" style="text-align: center" />
                            </td>
                        </tr>
                        <tr>
                            <td class="col-xs-2">0</td>

                            <td class="col-xs-10">
                                <input type="number" id="x3" name='x1' step="0.01" class="form-control" style="text-align: center" />
                            </td>
                        </tr>
                        <tr>
                            <td class="col-xs-2">0</td>

                            <td class="col-xs-10">
                                <input type="number" id="x4" name='x1' step="0.01" class="form-control" style="text-align: center" />
                            </td>
                        </tr>
                        <tr>
                            <td class="col-xs-2">0</td>

                            <td class="col-xs-10">
                                <input type="number" id="x5" name='x1' step="0.01" class="form-control" style="text-align: center" />
                            </td>
                        </tr>
                        <tr>
                            <td class="col-xs-2">0</td>

                            <td class="col-xs-10">
                                <input type="number" id="x6" name='x1' step="0.01" class="form-control" style="text-align: center"/>
                            </td>
                        </tr>
                        <tr>
                            <td class="col-xs-2">0</td>

                            <td class="col-xs-10">
                                <input type="number" id="x7" name='x1' step="0.01" class="form-control" style="text-align: center" />
                            </td>
                        </tr>
                        <tr>
                            <td class="col-xs-2">0</td>

                            <td class="col-xs-10">
                                <input type="number" id="x8" name='x1' step="0.01" class="form-control" style="text-align: center" />
                            </td>
                        </tr>
                        
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    
  <!--<div class="tbl-header col-xs-4" >
        <div class="container">
            <div class="row clearfix">
                <div class="col-md-1 column">
                    <table cellpadding="0" cellspacing="0" border="0" id="tab_logic">
                        <thead>
                        <tr>

                            <th class="text-center" style="color: red">
                                Tiempo
                            </th>
                            <th class="text-center" style="color: blue">
                                Posición
                            </th>


                        </tr>
                        </thead>
                        
                            <tbody class="tbl-content">
                                <tr id='addr0'>

                                    <td>
                                        <input type="number" id="x2" name='x1' step="0.01" class="form-control" style="text-align: center" readonly />
                                    </td>
                                    <td>
                                        <input type="number" id="y1" step="0.01" name='mail0' style="text-align: center" class="form-control" />
                                    </td>

                                </tr>
                                <tr id='addr0'>

                                    <td>
                                        <input type="number" id="x2" name='x1' step="0.01" class="form-control" style="text-align: center" readonly />
                                    </td>
                                    <td>
                                        <input type="number" id="y1" step="0.01" name='mail0' style="text-align: center" class="form-control" />
                                    </td>

                                </tr>
                                <tr id='addr0'>

                                    <td>
                                        <input type="number" id="x2" name='x1' step="0.01" class="form-control" style="text-align: center" readonly />
                                    </td>
                                    <td>
                                        <input type="number" id="y1" step="0.01" name='mail0' style="text-align: center" class="form-control" />
                                    </td>

                                </tr>
                                <tr id='addr0'>

                                    <td>
                                        <input type="number" id="x2" name='x1' step="0.01" class="form-control" style="text-align: center" readonly />
                                    </td>
                                    <td>
                                        <input type="number" id="y1" step="0.01" name='mail0' style="text-align: center" class="form-control" />
                                    </td>

                                </tr>
                                <tr id='addr0'>

                                    <td>
                                        <input type="number" id="x2" name='x1' step="0.01" class="form-control" style="text-align: center" readonly />
                                    </td>
                                    <td>
                                        <input type="number" id="y1" step="0.01" name='mail0' style="text-align: center" class="form-control" />
                                    </td>

                                </tr>
                            </tbody>
                      
                    </table>
                </div>
            </div>
        </div>
    </div>-->  
</div>

<div class="row">
    <div class="col-xs-6">
        <div id='PositionBoard' class='jxgbox graphbox'        style='user-select: none; overflow: hidden; position: relative;'></div>
    </div>
    
    <div class="col-xs-4">
        <div class="row">
            <div class="panel panel-default">
                <div class="panel-heading">
                    <h4 id="Formuposi" style="text-align: center">
                        
                    </h4>
                </div>
                <table class="table table-fixed">
                    <thead>
                        <tr>
                            <th class="col-xs-2 ">X</th>
                            <th class="col-xs-8 "></th>
                            <th class="col-xs-2 ">Y</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td class="col-xs-2">
                                0
                            </td>

                            <td class="col-xs-10">
                                <input type="number" id="y1" name='x1' step="0.01" class="form-control" style="text-align: center" />
                            </td>
                        </tr>
                        <tr>
                            <td class="col-xs-2">0</td>

                            <td class="col-xs-10">
                                <input type="number" id="y2" name='x1' step="0.01" class="form-control" style="text-align: center" />
                            </td>
                        </tr>
                        <tr>
                            <td class="col-xs-2">0</td>

                            <td class="col-xs-10">
                                <input type="number" id="y3" name='x1' step="0.01" class="form-control" style="text-align: center" />
                            </td>
                        </tr>
                        <tr>
                            <td class="col-xs-2">0</td>

                            <td class="col-xs-10">
                                <input type="number" id="y4" name='x1' step="0.01" class="form-control" style="text-align: center" />
                            </td>
                        </tr>
                        <tr>
                            <td class="col-xs-2">0</td>

                            <td class="col-xs-10">
                                <input type="number" id="y8" name='x1' step="0.01" class="form-control" style="text-align: center" />
                            </td>
                        </tr>
                        <tr>
                            <td class="col-xs-2">0</td>

                            <td class="col-xs-10">
                                <input type="number" id="y5" name='x1' step="0.01" class="form-control" style="text-align: center" />
                            </td>
                        </tr>
                        <tr>
                            <td class="col-xs-2">0</td>

                            <td class="col-xs-10">
                                <input type="number" id="y6" name='x1' step="0.01" class="form-control" style="text-align: center" />
                            </td>
                        </tr>
                        <tr>
                            <td class="col-xs-2">0</td>

                            <td class="col-xs-10">
                                <input type="number" id="y7" name='x1' step="0.01" class="form-control" style="text-align: center" />
                            </td>
                        </tr>

                    </tbody>
                </table>
            </div>
        </div>
    </div>

   <!--<div class="col-xs-4">
        <div class="container">
            <div class="row clearfix">
                <div class="col-md-2 column">
                    <table class="table table-bordered table-hover" id="tab_logic">
                        <thead>
                            <tr>

                                <th class="text-center" style="color: red">
                                    Tiempo
                                </th>
                                <th class="text-center" style="color: blue">
                                    Posición
                                </th>


                            </tr>
                        </thead>
                        <tbody>
                            <tr id='addr0'>

                                <td>
                                    <input type="number" id="x1" name='x1' step="0.01" class="form-control" style="text-align: center" />
                                </td>
                                <td>
                                    <input type="number" id="y2" step="0.01" name='mail0' style="text-align: center" class="form-control" readonly />
                                </td>

                            </tr>
                            <tr id='addr1'></tr>
                        </tbody>
                    </table>
                </div>
            </div>
           
        </div>
    </div>--> 
</div>
   
    







<script type='text/javascript'>
   

    var currentTime = 0;
    var interval;
    var timeInterval = 50;
    var guidingLine;
    var maxX = 9, minX = -1, maxY = 5, minY = -5;
    var startButton = document.getElementById("start");
    var numberField = document.getElementById("number");
    var numberField2 = document.getElementById("number2");
    var numtable = document.getElementById("table1");
    var numtable2 = document.getElementById("table2");
    var tablax1 = document.getElementById("x1");
    var tablax2 = document.getElementById("x2");
    var tablax3 = document.getElementById("x3");
    var tablax4 = document.getElementById("x4");
    var tablax5 = document.getElementById("x5");
    var tablax6 = document.getElementById("x6");
    var tablax7 = document.getElementById("x7");
    var tablax8 = document.getElementById("x8");
    var tablay1 = document.getElementById("y1");
    var tablay2 = document.getElementById("y2");
    var tablay3 = document.getElementById("y3");
    var tablay4 = document.getElementById("y4");
    var tablay5 = document.getElementById("y5");
    var tablay6 = document.getElementById("y6");
    var tablay7 = document.getElementById("y7");
    var tablay8 = document.getElementById("y8");
    var xxx =0;
    var firstUpdate = true;
    var addrow = document.getElementById("add_row");
    var delerow = document.getElementById("delete_row");
    var value;
    var Formulapos = document.getElementById("Formuposi");
    var Formulavelo = document.getElementById("Formuvelo");
    var check = true;
    var pintarotrosPuntos;
    var pintarPuntos;
    
    
    

    function updateFromNumber() {
        if (firstUpdate) {
            firstUpdate = false;
            //  positionFunction.a = parseFloat(numberField.value);
            // linearPoint = quadraticFunction.derivate();
            updateFunction();
        }
    }

    function updateFromTable() {
        if (firstUpdate) {
            firstUpdate = false;
            xxx = parseFloat(tablax1.value);
            updateFunction();
        }

    }
    function updateFromXY() {
        if (firstUpdate) {
            firstUpdate = false;

            updateFunction();
        }

    }

    function Start() {
        startButton.disabled = true;
        currentTime = parseInt(document.getElementsByName("startTime")[0].value);
        interval = window.setInterval(Step, timeInterval);
        guidingLine = positionBoard.create('line', [[currentTime, minY], [currentTime, maxY]], { straightFirst: false, straightLast: false, strokeWidth: 2 })
    }

    function Step() {
        currentTime += timeInterval / 1000;
        if (currentTime >= parseInt(document.getElementsByName("endTime")[0].value)) {
            clearInterval(interval);
            positionBoard.removeObject(guidingLine);
            startButton.disabled = false;
        }
        else {
            value = positionFunction.evaluate(currentTime);
            slider.setValue(value);
            sliderBox.update();

            positionBoard.removeObject(guidingLine);
            guidingLine = positionBoard.create('line', [[currentTime, minY], [currentTime, maxY]], { straightFirst: false, straightLast: false, strokeWidth: 2 })
        }
    }

    function SnapToGrid(x, y) {
        return [Math.round(x * 100) / 100, Math.round(y * 100) / 100];
    }

    var FormulaDiv = document.getElementById("FormulaDisplayDiv");


    var positionBoard = JXG.JSXGraph.initBoard('PositionBoard',
    {
        boundingbox: [-2, 9, 9, -2],
        axis: true,
        grid: true,
        shownavigation: true,
        keepAspectRatio: true,
        showClearTraces: true,
        keepaspectratio:false });
  

    var velocityBoard = JXG.JSXGraph.initBoard('VelocityBoard', { boundingbox: [-2, 9, 9, -2], axis: true, grid: true, shownavigation: true, keepAspectRatio: true, showClearTraces: true, keepaspectratio :false});
    


    var sliderBox = JXG.JSXGraph.initBoard('sliderBox', { boundingbox: [-(minY * (maxX - minX)), 5, minY * (maxX - minX), -5], axis: false,grid: true, shownavigation: true, showCopyright: false, keepAspectRatio: true });
    var urlImg = "https://vignette4.wikia.nocookie.net/kirby/images/0/01/Kirby_Artwork_Caminando_%28KA%29.png/revision/latest?cb=20100808233646";
    // var slider = sliderBox.create('slider', [urlImg,[1,1],[1,1] ]);
    var slider = sliderBox.create('slider', [[-(minY * (maxX - minX)), 0], [(minY * (maxX - minX)), 0], [(minY * (maxX - minX)), 0, -(minY * (maxX - minX))]], { ticks: { drawLabels: false, highlight: false,size:5,opacity:0.3 } });
    var im = sliderBox.create('image', [urlImg, [function () { return slider.X(); }, function () { return slider.Y(); }], [5, 5]]);
    // var im = sliderBox.create('image', [], [function() { return slider.X(); }], [1, 1]]);

    velocityBoard.highlightInfobox = function (x, y, el) {
        velocityBoard.infobox.setText('(' + el.X().toFixed(2) + ', ' + el.Y().toFixed(2) + ')');
    };

    positionBoard.highlightInfobox = function (x, y, el) {
        positionBoard.infobox.setText('(' + el.X().toFixed(2) + ', ' + el.Y().toFixed(2) + ')');
    };

    var positionFunction = new LinearFunction(1, 0);
    var velocityFunction = positionFunction.derivate();

    positionBoard.create(
        'functiongraph',
        [function (x) { return positionFunction.evaluate(x); }],
        { strokeColor: "Blue" }
    );

    velocityBoard.create(
        'functiongraph',
        [function (x) { return velocityFunction.evaluate(x); }],
        { strokeColor: "Red" }
    );

    linearPoint = positionBoard.create('point', [0, 0], { size: 2, name: "", color: "Blue" });
    linearPoint.on(
        'drag',
        function() {
            linearPoint.moveTo([0, linearPoint.Y()]);

            
        }
    );

    constantPoint = velocityBoard.create('point', [0, positionFunction.a], { size: 2, name: "", color: "Red" });
    constantPoint.on(
        'drag',
        function() {
            constantPoint.moveTo([0, constantPoint.Y()]);
         
        }
    );

    function updateFunction() {

        velocityFunction.a = constantPoint.Y();
        positionFunction = velocityFunction.integrate(linearPoint.Y());

        positionBoard.removeObject(pintarPuntos);
        positionBoard.removeObject(pintarotrosPuntos);
        //velocityBoard.removeObject(pintarPuntos);
        //velocityBoard.removeObject(pintarotrosPuntos);
        //form

        updateform();
        //form2
        updateform2();
        //input
        updatenumerfield();
        //table
       // updatetablenum();
        //text html
        updateformhtml();
        //positionBoard.update();
        //velocityBoard.update();
    }
    
   

    function updatenumerfield() {
        numberField2.value = positionFunction.a;
        numberField.value =positionFunction.b;
        numberField2.value = Math.round(numberField2.value * 100) / 100;
        numberField.value = Math.round(numberField.value * 100) / 100;
    }

   /* function updatetablenum() {
        numtable.value = velocityFunction.a;
        numtable2.value = positionFunction.b;
        numtable.value = Math.round(numtable.value * 100) / 100;
        numtable2.value = Math.round(numtable2.value * 100) / 100;
    }*/
    function updateform(parameters) {
        var  otronum =0.00;
        otronum = parseFloat(numberField.value) + parseFloat(numberField2.value * tablax1.value);
        pintarPuntos = positionBoard.create('point', [tablax1.value, otronum], { size: 2, name: "", color: "Red", trace: true });
    
        //velocityBoard.addChild(positionBoard);

    }
    function updateform2(parameters) {

        var otro2 = 0.00;
        otro2 = ((parseFloat(tablay1.value) - parseFloat(numberField.value)) / parseFloat(numberField2.value));
        pintarotrosPuntos = positionBoard.create('point', [otro2, tablay1.value], { size: 2, name: "", color: "Red", trace: true });
        //velocityBoard.addChild(positionBoard);

    }

    function checar(parameters) {
        // board.clearTraces(pintarPuntos);
        
       
        pintarPuntos.setAttribute({ visible: false });
        pintarotrosPuntos.setAttribute({ visible: false });
      

        // tablax1.value = " ";
        //tablay1.value = " ";


    }
    function updateformhtml(parameters) {
        FormulaDiv.innerHTML = positionFunction.ToString();
        Formulavelo.innerHTML = "X:0    Y:" + numberField2.value;
        Formulapos.innerHTML = "X:0     Y:" + numberField.value;
    }
   
    positionBoard.on('update', updateFunction);
    velocityBoard.on('update', updateFunction);
    positionBoard.on('update', checar);
    velocityBoard.on('update', checar);
    updateFunction();
</script>
